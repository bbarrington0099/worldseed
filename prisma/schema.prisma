// Alabastria Prisma Schema
// Full data model for D&D world management application

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================================================
// USER & AUTHENTICATION (Auth.js Compatible)
// ============================================================================

enum UserRole {
  ADMIN
  DM
  GUILD_MEMBER
}

model User {
  id                 String    @id @default(cuid())
  name               String?
  email              String    @unique
  emailVerified      DateTime?
  image              String?
  passwordHash       String
  role               UserRole  @default(GUILD_MEMBER)
  mustChangePassword Boolean   @default(true)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  // Auth.js relations
  accounts Account[]
  sessions Session[]

  // App relations
  characters           Character[]
  questReportsAuthored QuestReport[]     @relation("AuthoredBy")
  guildMemberships     GuildMembership[]
  dmGuilds             GuildDM[]
  managedGuildMembers  GuildMember[]     @relation("ManagedBy")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ============================================================================
// WORLD & GEOGRAPHY
// ============================================================================

enum Plane {
  MATERIAL
  SHADOWFELL
  FEYWILD
  POSITIVE
  NEGATIVE
  ETHEREAL
  ASTRAL
  FIRE
  AIR
  WATER
  EARTH
  THE_NINE_HELLS
  ABYSS
  MOUNT_CELESTIA
  BYTOPIA
  ELYSIUM
  BEASTLANDS
  ARBOREA
  YSGARD
  LIMBO
  PANDEMONIUM
  CARCERI
  HADES
  GEHENNA
  ACHERON
  MECHANUS
  ARCHADIA
  OUTLANDS
}

model World {
  id              String  @id @default(uuid())
  seeded          Boolean @default(false)
  name            String  @unique
  slug            String  @unique
  description     String  @db.Text
  plane           Plane   @default(MATERIAL)
  circumferenceMi Int?
  diameterMi      Int?
  surfaceAreaSqMi BigInt?
  currentCycle    Int
  currentMonth    Month
  currentDay      Int

  continents Continent[]
  kingdoms   Kingdom[]
}

model Continent {
  id                String  @id @default(uuid())
  seeded            Boolean @default(false)
  name              String  @unique
  slug              String  @unique
  description       String  @db.Text
  plane             Plane   @default(MATERIAL)
  widthMi           Int?
  heightMi          Int?
  surfaceAreaSqMi   BigInt?
  languageReasoning String? @db.Text

  // Flag/Colors
  primaryColor    String?
  secondaryColor  String?
  flagSymbol      String?
  flagDescription String? @db.Text
  mapImagePath    String?
  flagImagePath   String?

  // Politics
  governmentType      GovernmentType
  politicalStructure  String?        @db.Text
  majorPoliticalIssue String?        @db.Text
  foreignRelations    String?        @db.Text

  // Relations
  worldId   String
  world     World    @relation(fields: [worldId], references: [id])
  kingdomId String?
  kingdom   Kingdom? @relation(fields: [kingdomId], references: [id])

  capitalTownId String? @unique
  capitalTown   Town?   @relation("ContinentCapital", fields: [capitalTownId], references: [id])

  capitalOfKingdom Kingdom? @relation("KingdomCapital")

  towns              Town[]
  regions            Region[]
  primaryLanguages   Language[] @relation("PrimaryLanguages")
  secondaryLanguages Language[] @relation("SecondaryLanguages")
  rareLanguages      Language[] @relation("RareLanguages")

  voyagesFrom            Voyage[]                         @relation("FromContinent")
  voyagesTo              Voyage[]                         @relation("ToContinent")
  warsConflicts          WarConflict[]
  treaties               Treaty[]
  tradeRoutes            TradeRoute[]
  raceLocations          RaceContinent[]
  guilds                 Guild[]
  creatureTypes          ContinentCreatureType[]
  legendaryCreatures     LegendaryCreature[]
  deityRecommendations   DeityRecommendation[]
  historicalEvents       HistoricalEvent[]
  professionRestrictions ProfessionContinentRestriction[]
  factionPresence        FactionContinentPresence[]
  ruler                  CharacterContinentRuler?
}

enum ContinentLanguagePrevalence {
  PRIMARY
  SECONDARY
  RARE
}

model Kingdom {
  id              String  @id @default(uuid())
  seeded          Boolean @default(false)
  name            String  @unique
  slug            String  @unique
  description     String? @db.Text
  plane           Plane   @default(MATERIAL)
  surfaceAreaSqMi BigInt?
  primaryColor    String?
  secondaryColor  String?
  flagSymbol      String?
  flagDescription String? @db.Text

  cycleEstablished Int
  monthEstablished Month?
  dayEstablished   Int?
  cycleDissolved   Int?
  monthDissolved   Month?
  dayDissolved     Int?

  governmentType      GovernmentType
  politicalStructure  String?        @db.Text
  majorPoliticalIssue String?        @db.Text
  foreignRelations    String?        @db.Text

  worldId String
  world   World  @relation(fields: [worldId], references: [id])

  continents Continent[]

  capitalContinentId String?    @unique
  capitalContinent   Continent? @relation("KingdomCapital", fields: [capitalContinentId], references: [id])

  ruler CharacterKingdomRuler?
}

enum TownType {
  HAMLET
  VILLAGE
  TOWN
  CITY
  CAPITAL
}

model Town {
  id          String   @id @default(uuid())
  seeded      Boolean  @default(false)
  name        String
  slug        String   @unique
  description String   @db.Text
  plane       Plane    @default(MATERIAL)
  location    String?
  population  Int?
  type        TownType @default(VILLAGE)

  continentId String
  continent   Continent @relation(fields: [continentId], references: [id])

  capitalOfContinent Continent? @relation("ContinentCapital")

  regions                Region[]                    @relation("RegionTowns")
  guildHalls             GuildHall[]
  professionRestrictions ProfessionTownRestriction[]
  factionBases           FactionBase[]
  characterJobs          CharacterTownJob[]
  factionRelationships   FactionTownRelationship[]
  graveyard              Graveyard?
  tripsFrom              Road[]                      @relation("FromTown")
  tripsTo                Road[]                      @relation("ToTown")
  tradeRoutes            TradeRoute[]

  @@unique([continentId, slug])
}

model Region {
  id          String    @id @default(uuid())
  seeded      Boolean   @default(false)
  name        String    @unique
  description String?   @db.Text
  plane       Plane     @default(MATERIAL)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  continentId String
  continent   Continent @relation(fields: [continentId], references: [id])
  towns       Town[]    @relation("RegionTowns")
}

model Voyage {
  id          String  @id @default(uuid())
  seeded      Boolean @default(false)
  name        String  @unique
  distanceMi  Int?
  travelDays  Int?
  travelHours Float?

  tradeRoutes     TradeRoute[]
  fromContinentId String
  fromContinent   Continent    @relation("FromContinent", fields: [fromContinentId], references: [id])
  toContinentId   String
  toContinent     Continent    @relation("ToContinent", fields: [toContinentId], references: [id])

  @@unique([fromContinentId, toContinentId])
}

model Road {
  id            String  @id @default(uuid())
  seeded        Boolean @default(false)
  distanceMi    Int?
  travelDays    Int?
  travelHours   Int?
  travelMinutes Int?

  tradeRoutes TradeRoute[]
  fromTownId  String
  fromTown    Town         @relation("FromTown", fields: [fromTownId], references: [id], onDelete: Cascade)
  toTownId    String
  toTown      Town         @relation("ToTown", fields: [toTownId], references: [id], onDelete: Cascade)

  @@unique([fromTownId, toTownId])
}

enum GovernmentType {
  MONARCHY
  REPUBLIC
  THEOCRACY
  TRIBAL
  DICTATORSHIP
  OLIGARCHY
  ANARCHY
  EMPIRE
  MAGICAL_CONCLAVE
}

enum WarConflictStatus {
  RESOLVED
  COLD_WAR
  LOW_INTENSITY
  HIGH_INTENSITY
}

model WarConflict {
  id          String            @id @default(uuid())
  seeded      Boolean           @default(false)
  name        String
  description String?           @db.Text
  startCycle  Int?
  endCycle    Int?
  outcome     String?           @db.Text
  status      WarConflictStatus

  continentsInvolved Continent[]
}

model Treaty {
  id          String  @id @default(uuid())
  seeded      Boolean @default(false)
  name        String
  signedCycle Int?
  terms       String? @db.Text

  continentsInvolved Continent[]
}

enum TradeRouteType {
  OVERLAND
  UNDERGROUND
  MARITIME
  UNDERWATER
  AERIAL
  OVERLAND_TO_MARITIME
  UNDERGROUND_TO_MARITIME
}

enum TradeRouteFrequency {
  DAILY
  WEEKLY
  BI_WEEKLY
  MONTHLY
  YEARLY
  IRREGULAR
}

model TradeRoute {
  id          String              @id @default(uuid())
  seeded      Boolean             @default(false)
  name        String
  description String?             @db.Text
  goods       String[]
  routeType   TradeRouteType
  frequency   TradeRouteFrequency

  continentStops Continent[]
  voyages        Voyage[]
  townStops      Town[]
  roads          Road[]
}

// ============================================================================
// WORLD HISTORY & TIMELINE
// ============================================================================

model HistoricalPeriod {
  id           String  @id @default(uuid())
  seeded       Boolean @default(false)
  name         String  @unique
  startCycle   Int
  endCycle     Int?
  description  String  @db.Text
  significance String? @db.Text
  sortOrder    Int     @default(0)

  events HistoricalEvent[]
}

model HistoricalEvent {
  id          String  @id @default(uuid())
  seeded      Boolean @default(false)
  name        String
  cycle       Int
  description String  @db.Text
  impact      String? @db.Text
  sortOrder   Int     @default(0)

  periodId    String?
  period      HistoricalPeriod? @relation(fields: [periodId], references: [id])
  continentId String?
  continent   Continent?        @relation(fields: [continentId], references: [id])
}

// ============================================================================
// RACES & CLASSES
// ============================================================================

model Race {
  id             String  @id @default(uuid())
  seeded         Boolean @default(false)
  name           String  @unique
  slug           String  @unique
  description    String  @db.Text
  speed          String?
  age            String? @db.Text
  alignment      String? @db.Text
  heightRange    String?
  weightRange    String?
  alabastriaLore String? @db.Text
  playstyle      String? @db.Text

  defaultCreatureSizeId String @default("creature-size-medium")
  defaultCreatureSize   CreatureSize @relation(fields: [defaultCreatureSizeId], references: [id])

  namesId String? @unique
  names   RaceName? @relation(fields: [namesId], references: [id], onDelete: Cascade)

  abilityScoreIncreases RaceAbilityScore[]
  languages             Language[]
  traits                RaceTrait[]

  subraces              Subrace[]
  recommendedClasses    RaceClassRecommendation[]
  continentLocations    RaceContinent[]
  deityRecommendations  DeityRecommendation[]     @relation("RaceDeityRecs")
  characters            Character[]
}

enum RaceAbilityScores {
  STRENGTH
  DEXTERITY
  CONSTITUTION
  INTELLIGENCE
  WISDOM
  CHARISMA
  ANY_OTHER
}

model RaceAbilityScore {
  id       String            @id @default(uuid())
  ability  RaceAbilityScores
  seeded   Boolean           @default(false)
  modifier Int

  races Race[]
  subraces Subrace[]

  @@unique([ability, modifier])
}

model RaceTrait {
  id          String  @id @default(uuid())
  seeded      Boolean @default(false)
  name        String
  description String? @db.Text

  races Race[]
  subraces Subrace[]
}

model RaceName {
  id     String  @id @default(uuid())
  seeded Boolean @default(false)
  male String[]
  female String[]
  unisex String[]
  surname String[]

  raceId String?
  race   Race? 

  subraceId String?
  subrace   Subrace?
}

model RaceContinent {
  id          String  @id @default(uuid())
  description String? @db.Text

  raceId      String
  race        Race      @relation(fields: [raceId], references: [id], onDelete: Cascade)
  continentId String
  continent   Continent @relation(fields: [continentId], references: [id])

  @@unique([raceId, continentId])
}

model Language {
  id          String  @id @default(uuid())
  seeded      Boolean @default(false)
  name        String
  description String? @db.Text

  races               Race[]
  continentsPrimary   Continent[] @relation("PrimaryLanguages")
  continentsSecondary Continent[] @relation("SecondaryLanguages")
  continentsRare      Continent[] @relation("RareLanguages")
  characters          Character[]
}

model Subrace {
  id                String  @id @default(uuid())
  name              String
  slug              String
  description       String  @db.Text
  alabastriaContext String? @db.Text
  playstyle         String? @db.Text
  seeded            Boolean @default(false)
  
  speedOverride             String?
  ageOverride               String?
  alignmentOverride         String?
  heightRangeOverride       String?
  weightRangeOverride       String?

  namesOverrideAppend Boolean @default(false)
  namesIdOverride     String? @unique
  namesOverride       RaceName? @relation(fields: [namesIdOverride], references: [id], onDelete: Cascade)

  raceId                String
  race                  Race                  @relation(fields: [raceId], references: [id], onDelete: Cascade)

  abilityScoreIncreases RaceAbilityScore[]
  traits                RaceTrait[]

  deityRecommendations  DeityRecommendation[] @relation("SubraceDeityRecs")
  characters            Character[]

  @@unique([raceId, slug])
}

model Class {
  id                String  @id @default(uuid())
  name              String  @unique
  slug              String  @unique
  description       String  @db.Text
  role              String?
  primaryAbility    String?
  hitDie            String?
  armorProficiency  String?
  weaponProficiency String?
  toolProficiency   String?
  alabastriaLore    String? @db.Text
  playstyle         String? @db.Text
  seeded            Boolean @default(false)

  savingThrows         ClassSavingThrow[]
  keyFeatures          ClassFeature[]
  subclasses           Subclass[]
  recommendedRaces     RaceClassRecommendation[]
  playstyleCategories  PlaystyleClassRecommendation[]
  deityRecommendations DeityRecommendation[]          @relation("ClassDeityRecs")
  characters           Character[]
}

model ClassSavingThrow {
  id      String @id @default(uuid())
  ability String

  classId String
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@unique([classId, ability])
}

model ClassFeature {
  id          String  @id @default(uuid())
  name        String
  level       Int?
  description String? @db.Text

  classId String
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)
}

model Subclass {
  id                String  @id @default(uuid())
  name              String
  slug              String
  description       String  @db.Text
  alabastriaContext String? @db.Text
  playstyle         String? @db.Text
  seeded            Boolean @default(false)

  classId              String
  class                Class                 @relation(fields: [classId], references: [id], onDelete: Cascade)
  keyFeatures          SubclassFeature[]
  deityRecommendations DeityRecommendation[] @relation("SubclassDeityRecs")
  characters           Character[]

  @@unique([classId, slug])
}

model SubclassFeature {
  id          String  @id @default(uuid())
  name        String
  level       Int?
  description String? @db.Text

  subclassId String
  subclass   Subclass @relation(fields: [subclassId], references: [id], onDelete: Cascade)
}

model RaceClassRecommendation {
  id        String  @id @default(uuid())
  reasoning String? @db.Text

  raceId  String
  race    Race   @relation(fields: [raceId], references: [id], onDelete: Cascade)
  classId String
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@unique([raceId, classId])
}

// ============================================================================
// PANTHEON & DEITIES
// ============================================================================

model Pantheon {
  id          String  @id @default(uuid())
  name        String  @unique
  slug        String  @unique
  description String  @db.Text
  symbol      String?
  seeded      Boolean @default(false)

  deities Deity[]
}

model Deity {
  id                String  @id @default(uuid())
  name              String  @unique
  slug              String  @unique
  title             String?
  alignment         String?
  symbol            String?
  description       String  @db.Text
  alabastriaContext String? @db.Text
  temples           String? @db.Text
  seeded            Boolean @default(false)

  pantheonId String
  pantheon   Pantheon @relation(fields: [pantheonId], references: [id])

  domains   DeityDomain[]
  followers DeityFollower[]
  holyDays  DeityHolyDay[]
  symbols   DeitySymbol[]
  colors    DeityColor[]
  history   DeityHistory[]

  alliesFrom DeityRelationship[] @relation("DeityFrom")
  alliesTo   DeityRelationship[] @relation("DeityTo")

  recommendations DeityRecommendation[]
  characters      Character[]
}

model DeityDomain {
  id     String @id @default(uuid())
  domain String

  deityId String
  deity   Deity  @relation(fields: [deityId], references: [id], onDelete: Cascade)

  @@unique([deityId, domain])
}

model DeityFollower {
  id           String  @id @default(uuid())
  followerType String
  description  String? @db.Text

  deityId String
  deity   Deity  @relation(fields: [deityId], references: [id], onDelete: Cascade)
}

model DeityHolyDay {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  deityId String
  deity   Deity  @relation(fields: [deityId], references: [id], onDelete: Cascade)
}

model DeitySymbol {
  id          String  @id @default(uuid())
  symbol      String
  description String? @db.Text

  deityId String
  deity   Deity  @relation(fields: [deityId], references: [id], onDelete: Cascade)
}

model DeityColor {
  id    String @id @default(uuid())
  color String

  deityId String
  deity   Deity  @relation(fields: [deityId], references: [id], onDelete: Cascade)
}

model DeityHistory {
  id          String  @id @default(uuid())
  era         String?
  description String? @db.Text

  deityId String
  deity   Deity  @relation(fields: [deityId], references: [id], onDelete: Cascade)
}

enum DeityRelationshipCategory {
  ALLY
  CONFLICT
}

model DeityRelationship {
  id        String                    @id @default(uuid())
  type      DeityRelationshipCategory
  reasoning String?                   @db.Text

  deityId        String
  deity          Deity  @relation("DeityFrom", fields: [deityId], references: [id], onDelete: Cascade)
  relatedDeityId String
  relatedDeity   Deity  @relation("DeityTo", fields: [relatedDeityId], references: [id], onDelete: Cascade)

  @@unique([deityId, relatedDeityId, type])
}

model DeityRecommendation {
  id        String  @id @default(uuid())
  isPrimary Boolean @default(true)
  reasoning String? @db.Text

  deityId     String
  deity       Deity      @relation(fields: [deityId], references: [id], onDelete: Cascade)
  raceId      String?
  race        Race?      @relation("RaceDeityRecs", fields: [raceId], references: [id])
  subraceId   String?
  subrace     Subrace?   @relation("SubraceDeityRecs", fields: [subraceId], references: [id])
  classId     String?
  class       Class?     @relation("ClassDeityRecs", fields: [classId], references: [id])
  subclassId  String?
  subclass    Subclass?  @relation("SubclassDeityRecs", fields: [subclassId], references: [id])
  continentId String?
  continent   Continent? @relation(fields: [continentId], references: [id])
}

// ============================================================================
// GUILDS & MEMBERS
// ============================================================================

enum GuildRank {
  COAL
  COPPER
  IRON
  SILVER
  GOLD
  PLATINUM
  MITHRAL
}

enum MemberStatus {
  ACTIVE
  INACTIVE
  DECEASED
  RETIRED
  MISSING
  HIATUS
  EXPELLED
  ABROAD
}

model Guild {
  id           String  @id @default(uuid())
  name         String  @unique
  slug         String  @unique
  description  String  @db.Text
  emblemPath   String?
  foundedCycle Int?
  seeded       Boolean @default(false)

  continents  Continent[]
  guildHalls  GuildHall[]
  roles       GuildRole[]
  staff       GuildStaff[]
  members     GuildMember[]
  quests      QuestReport[]
  dms         GuildDM[]
  memberships GuildMembership[]
}

model GuildDM {
  id      String @id @default(uuid())
  userId  String
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  guildId String
  guild   Guild  @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@unique([userId, guildId])
}

model GuildMembership {
  id      String @id @default(uuid())
  userId  String
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  guildId String
  guild   Guild  @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@unique([userId, guildId])
}

model GuildRole {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text
  seeded      Boolean @default(false)

  guildStaff GuildStaff[]
  guild      Guild[]
}

model GuildStaff {
  id     String    @id @default(uuid())
  rank   GuildRank
  seeded Boolean   @default(false)

  guildRoleId String
  guildRole   GuildRole  @relation(fields: [guildRoleId], references: [id], onDelete: Cascade)
  characterId String     @unique
  character   Character  @relation(fields: [characterId], references: [id], onDelete: Cascade)
  guildId     String
  guild       Guild      @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildHallId String?
  guildHall   GuildHall? @relation(fields: [guildHallId], references: [id])
}

model GuildMember {
  id             String       @id @default(uuid())
  rank           GuildRank
  status         MemberStatus @default(ACTIVE)
  specialization String?
  seeded         Boolean      @default(false)

  characterId String    @unique
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  guildId     String
  guild       Guild     @relation(fields: [guildId], references: [id], onDelete: Cascade)
  managedById String?
  managedBy   User?     @relation("ManagedBy", fields: [managedById], references: [id])

  tags                GuildMemberTag[]               @relation("GuildMemberTag")
  achievements        GuildMemberAchievement[]       @relation("GuildMemberAchievement")
  questParticipations QuestParticipant[]
  factionMemberships  FactionGuildMemberMembership[] @relation("FactionGuildMember")
}

model GuildMemberTag {
  id  String @id @default(uuid())
  tag String

  members GuildMember[] @relation("GuildMemberTag")
}

model GuildMemberAchievement {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text
  earnedCycle Int?

  members GuildMember[] @relation("GuildMemberAchievement")
}

model GuildHall {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?  @db.Text
  imagePath   String?
  services    String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  seeded      Boolean  @default(false)

  guildId     String
  guild       Guild        @relation(fields: [guildId], references: [id], onDelete: Cascade)
  staff       GuildStaff[]
  graveyard   Graveyard?
  graveyardId String?      @unique
  townId      String
  town        Town         @relation(fields: [townId], references: [id], onDelete: Cascade)
}

// ============================================================================
// CHARACTERS
// ============================================================================

enum Month {
  JANUARY
  FEBRUARY
  MARCH
  APRIL
  MAY
  JUNE
  JULY
  AUGUST
  SEPTEMBER
  OCTOBER
  NOVEMBER
  DECEMBER
}

model Character {
  id                String   @id @default(uuid())
  name              String
  level             Int      @default(1)
  backgroundSummary String?  @db.Text
  imagePath         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Demographics
  gender     String?
  age        Int?
  birthMonth Month?
  birthDay   Int?
  birthYear  Int?

  // Physical & Personality
  physicalDescription String? @db.Text
  appearance          String? @db.Text
  personality         String? @db.Text
  gearLoadout         String? @db.Text

  // Ability Scores
  strength     Int?
  dexterity    Int?
  constitution Int?
  intelligence Int?
  wisdom       Int?
  charisma     Int?
  hitPoints    Int?
  armorClass   Int?
  speed        Int?

  // Languages
  languages Language[]

  // Relations to Core Data
  userId         String?
  user           User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  raceId         String?
  race           Race?     @relation(fields: [raceId], references: [id])
  subraceId      String?
  subrace        Subrace?  @relation(fields: [subraceId], references: [id])
  classId        String?
  class          Class?    @relation(fields: [classId], references: [id])
  subclassId     String?
  subclass       Subclass? @relation(fields: [subclassId], references: [id])
  deityId        String?
  deity          Deity?    @relation(fields: [deityId], references: [id])
  deityReasoning String?   @db.Text

  creatureSizeId String       @default("creature-size-medium")
  creatureSize   CreatureSize @relation(fields: [creatureSizeId], references: [id])
  creatureTypeId String       @default("creature-type-humanoid")
  creatureType   CreatureType @relation(fields: [creatureTypeId], references: [id])

  // Character Role Links
  guildMember             GuildMember?
  guildStaff              GuildStaff?
  continentRuler          CharacterContinentRuler?
  kingdomRuler            CharacterKingdomRuler?
  townJobs                CharacterTownJob[]
  factionRelationships    CharacterFactionRelationship[]
  npcFactionMemberships   FactionNPCMembership[]
  guildFactionMemberships FactionGuildMemberMembership[] @relation("FactionGuildMemberChar")
  relationshipsFrom       CharacterRelationship[]        @relation("CharacterFrom")
  relationshipsTo         CharacterRelationship[]        @relation("CharacterTo")

  // Quest & Gameplay
  questReports QuestMemberReport[]

  // Graveyard
  graveyardEntry GraveyardEntry?
}

// Character Role Links
model CharacterTownJob {
  id          String  @id @default(uuid())
  jobTitle    String?
  description String? @db.Text

  // Job dates
  startMonth Month?
  startDay   Int?
  startYear  Int?
  endMonth   Month?
  endDay     Int?
  endYear    Int?

  characterId  String
  character    Character      @relation(fields: [characterId], references: [id], onDelete: Cascade)
  townId       String
  town         Town           @relation(fields: [townId], references: [id], onDelete: Cascade)
  professionId String?
  profession   NPCProfession? @relation(fields: [professionId], references: [id])
}

model CharacterKingdomRuler {
  id                 String    @id @default(uuid())
  name               String    @unique
  title              String?
  rulingStyle        String?   @db.Text
  startedRulingCycle Int?
  seeded             Boolean   @default(false)
  characterId        String    @unique
  character          Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  kingdomId          String    @unique
  kingdom            Kingdom   @relation(fields: [kingdomId], references: [id], onDelete: Cascade)
}

model CharacterContinentRuler {
  id                 String  @id @default(uuid())
  name               String  @unique
  title              String?
  rulingStyle        String? @db.Text
  startedRulingCycle Int?

  characterId String    @unique
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  continentId String    @unique
  continent   Continent @relation(fields: [continentId], references: [id], onDelete: Cascade)
}

// Character Relationships
model CharacterRelationship {
  id          String  @id @default(uuid())
  description String? @db.Text

  fromCharacterId String
  fromCharacter   Character @relation("CharacterFrom", fields: [fromCharacterId], references: [id], onDelete: Cascade)
  toCharacterId   String
  toCharacter     Character @relation("CharacterTo", fields: [toCharacterId], references: [id], onDelete: Cascade)

  relationshipTypeId String
  relationshipType   NPCRelationshipType @relation(fields: [relationshipTypeId], references: [id])

  @@unique([fromCharacterId, toCharacterId, relationshipTypeId])
}

// Graveyard
model Graveyard {
  id          String  @id @default(uuid())
  name        String?
  description String? @db.Text

  townId      String?    @unique
  town        Town?      @relation(fields: [townId], references: [id], onDelete: Cascade)
  factionId   String?    @unique
  faction     Faction?   @relation(fields: [factionId], references: [id], onDelete: Cascade)
  guildHallId String?    @unique
  guildHall   GuildHall? @relation(fields: [guildHallId], references: [id])

  entries GraveyardEntry[]
}

model GraveyardEntry {
  id                   String  @id @default(uuid())
  causeOfDeath         String? @db.Text
  headstoneInscription String? @db.Text

  deathMonth Month?
  deathDay   Int?
  deathYear  Int?

  characterId String    @unique
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  graveyardId String
  graveyard   Graveyard @relation(fields: [graveyardId], references: [id], onDelete: Cascade)
}

// ============================================================================
// QUEST REPORTS
// ============================================================================

model QuestReport {
  id             String    @id @default(uuid())
  name           String
  summary        String    @db.Text
  rank           GuildRank
  commissionedBy String?
  date           String?
  location       String?
  duration       String?
  outcome        String?
  extraNotes     String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  seeded         Boolean   @default(false)

  guildId  String
  guild    Guild   @relation(fields: [guildId], references: [id], onDelete: Cascade)
  authorId String?
  author   User?   @relation("AuthoredBy", fields: [authorId], references: [id])

  participants  QuestParticipant[]
  enemies       QuestEnemy[]
  awards        QuestAward[]
  loot          QuestLoot[]
  memberReports QuestMemberReport[]
  fallenMembers QuestFallenMember[]
}

model QuestParticipant {
  id         String    @id @default(uuid())
  rankAtTime GuildRank
  role       String?

  questId  String
  quest    QuestReport @relation(fields: [questId], references: [id], onDelete: Cascade)
  memberId String
  member   GuildMember @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([questId, memberId])
}

model QuestEnemy {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text
  quantity    Int?

  questId String
  quest   QuestReport @relation(fields: [questId], references: [id], onDelete: Cascade)
}

model QuestAward {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  questId String
  quest   QuestReport @relation(fields: [questId], references: [id], onDelete: Cascade)
}

model QuestLoot {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text
  quantity    Int?

  questId String
  quest   QuestReport @relation(fields: [questId], references: [id], onDelete: Cascade)
}

model QuestMemberReport {
  id         String  @id @default(uuid())
  report     String  @db.Text
  memberName String?

  questId     String
  quest       QuestReport @relation(fields: [questId], references: [id], onDelete: Cascade)
  characterId String?
  character   Character?  @relation(fields: [characterId], references: [id])
}

model QuestFallenMember {
  id         String  @id @default(uuid())
  memberName String
  cause      String? @db.Text

  questId String
  quest   QuestReport @relation(fields: [questId], references: [id], onDelete: Cascade)
}

// ============================================================================
// NPCs & PROFESSIONS
// ============================================================================

enum ProfessionRestrictionType {
  UNRESTRICTED
  CONTINENT
  TOWN
}

model NPCProfession {
  id              String                    @id @default(uuid())
  name            String                    @unique
  description     String?                   @db.Text
  category        String?
  seeded          Boolean                   @default(false)
  restrictionType ProfessionRestrictionType @default(UNRESTRICTED)

  restrictedToContinents ProfessionContinentRestriction[]
  restrictedToTowns      ProfessionTownRestriction[]
  characterJobs          CharacterTownJob[]
}

model ProfessionContinentRestriction {
  id String @id @default(uuid())

  professionId String
  profession   NPCProfession @relation(fields: [professionId], references: [id], onDelete: Cascade)
  continentId  String
  continent    Continent     @relation(fields: [continentId], references: [id], onDelete: Cascade)

  @@unique([professionId, continentId])
}

model ProfessionTownRestriction {
  id String @id @default(uuid())

  professionId String
  profession   NPCProfession @relation(fields: [professionId], references: [id], onDelete: Cascade)
  townId       String
  town         Town          @relation(fields: [townId], references: [id], onDelete: Cascade)

  @@unique([professionId, townId])
}

model NPCRelationshipType {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?
  seeded      Boolean @default(false)

  characterRelationships CharacterRelationship[]
}

// ============================================================================
// FACTIONS
// ============================================================================

enum FactionInfluenceLevel {
  MINOR
  MODERATE
  MAJOR
  DOMINANT
  HIDDEN
}

enum CharacterFactionRelationshipType {
  MEMBER
  LEADER
  FORMERMEMBER
  ALLY
  ENEMY
  NEUTRAL
  RIVAL
  SUPPORTER
}

model Faction {
  id           String   @id @default(uuid())
  name         String   @unique
  slug         String   @unique
  description  String   @db.Text
  mainPurpose  String   @db.Text
  emblemPath   String?
  foundedCycle Int?
  seeded       Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  continentPresence      FactionContinentPresence[]
  bases                  FactionBase[]
  npcMembers             FactionNPCMembership[]
  guildMembers           FactionGuildMemberMembership[]
  characterRelationships CharacterFactionRelationship[]
  relationshipsFrom      FactionRelationship[]          @relation("FactionFrom")
  relationshipsTo        FactionRelationship[]          @relation("FactionTo")
  townRelationships      FactionTownRelationship[]
  historicEvents         FactionHistoricEvent[]
  graveyard              Graveyard?
}

model FactionContinentPresence {
  id             String                @id @default(uuid())
  influenceLevel FactionInfluenceLevel
  description    String?               @db.Text

  factionId   String
  faction     Faction   @relation(fields: [factionId], references: [id], onDelete: Cascade)
  continentId String
  continent   Continent @relation(fields: [continentId], references: [id])

  @@unique([factionId, continentId])
}

model FactionBase {
  id               String  @id @default(uuid())
  name             String
  description      String  @db.Text
  townRelationship String  @db.Text
  isHeadquarters   Boolean @default(false)
  isSecret         Boolean @default(false)
  seeded           Boolean @default(false)

  factionId String
  faction   Faction @relation(fields: [factionId], references: [id], onDelete: Cascade)
  townId    String
  town      Town    @relation(fields: [townId], references: [id])

  npcMembers   FactionNPCMembership[]
  guildMembers FactionGuildMemberMembership[]

  @@unique([factionId, townId, name])
}

model FactionRole {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text
  rankOrder   Int     @default(0)
  seeded      Boolean @default(false)

  npcMemberships   FactionNPCMembership[]
  guildMemberships FactionGuildMemberMembership[]
}

model FactionNPCMembership {
  id          String  @id @default(uuid())
  joinedCycle Int?
  notes       String? @db.Text
  isSecret    Boolean @default(false)

  factionId   String
  faction     Faction      @relation(fields: [factionId], references: [id], onDelete: Cascade)
  characterId String
  character   Character    @relation(fields: [characterId], references: [id], onDelete: Cascade)
  roleId      String
  role        FactionRole  @relation(fields: [roleId], references: [id])
  baseId      String?
  base        FactionBase? @relation(fields: [baseId], references: [id])

  @@unique([factionId, characterId])
}

model FactionGuildMemberMembership {
  id          String  @id @default(uuid())
  joinedCycle Int?
  notes       String? @db.Text
  isSecret    Boolean @default(false)

  factionId     String
  faction       Faction      @relation(fields: [factionId], references: [id], onDelete: Cascade)
  guildMemberId String
  guildMember   GuildMember  @relation("FactionGuildMember", fields: [guildMemberId], references: [id], onDelete: Cascade)
  characterId   String
  character     Character    @relation("FactionGuildMemberChar", fields: [characterId], references: [id], onDelete: Cascade)
  roleId        String
  role          FactionRole  @relation(fields: [roleId], references: [id])
  baseId        String?
  base          FactionBase? @relation(fields: [baseId], references: [id])

  @@unique([factionId, guildMemberId])
  @@unique([factionId, characterId])
}

model FactionRelationshipType {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text
  seeded      Boolean @default(false)

  relationships FactionRelationship[]
}

model FactionRelationship {
  id          String  @id @default(uuid())
  description String? @db.Text
  since       Int?

  fromFactionId String
  fromFaction   Faction @relation("FactionFrom", fields: [fromFactionId], references: [id], onDelete: Cascade)
  toFactionId   String
  toFaction     Faction @relation("FactionTo", fields: [toFactionId], references: [id], onDelete: Cascade)

  relationshipTypeId String
  relationshipType   FactionRelationshipType @relation(fields: [relationshipTypeId], references: [id])

  @@unique([fromFactionId, toFactionId])
}

// Character-Faction Relationships
model CharacterFactionRelationship {
  id    String                           @id @default(uuid())
  type  CharacterFactionRelationshipType
  notes String?                          @db.Text

  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  factionId   String
  faction     Faction   @relation(fields: [factionId], references: [id], onDelete: Cascade)

  @@unique([characterId, factionId, type])
}

// Faction-Town Relationships
model FactionTownRelationship {
  id               String  @id @default(uuid())
  description      String? @db.Text
  relationshipType String // e.g., "ALLIED", "HOSTILE", "NEUTRAL", "CONTROLS", etc.

  factionId String
  faction   Faction @relation(fields: [factionId], references: [id], onDelete: Cascade)
  townId    String
  town      Town    @relation(fields: [townId], references: [id], onDelete: Cascade)

  @@unique([factionId, townId])
}

// Faction Historic Events
model FactionHistoricEvent {
  id          String @id @default(uuid())
  name        String
  description String @db.Text
  eventType   String // e.g., "FOUNDING", "LEADERSHIP_CHANGE", "ENEMY_DECLARED", "ALLY_FORMED", "ACHIEVEMENT", "MILESTONE"

  // Event date (all optional, independently optional)
  eventMonth Month?
  eventDay   Int?
  eventCycle Int?

  factionId String
  faction   Faction @relation(fields: [factionId], references: [id], onDelete: Cascade)

  @@index([factionId])
}

// ============================================================================
// PLAYSTYLE GUIDE
// ============================================================================

model PlaystyleCategory {
  id          String  @id @default(uuid())
  name        String  @unique
  description String  @db.Text
  seeded      Boolean @default(false)

  recommendations PlaystyleClassRecommendation[]
}

model PlaystyleClassRecommendation {
  id        String  @id @default(uuid())
  reasoning String? @db.Text

  playstyleId String
  playstyle   PlaystyleCategory @relation(fields: [playstyleId], references: [id], onDelete: Cascade)
  classId     String
  class       Class             @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@unique([playstyleId, classId])
}

model AbilityScorePriority {
  id          String  @id @default(uuid())
  ability     String  @unique
  description String  @db.Text
  seeded      Boolean @default(false)

  bestClasses  AbilityScoreClass[]
  importantFor AbilityScoreImportance[]
}

model AbilityScoreClass {
  id String @id @default(uuid())

  abilityId String
  ability   AbilityScorePriority @relation(fields: [abilityId], references: [id], onDelete: Cascade)
  className String
}

model AbilityScoreImportance {
  id          String  @id @default(uuid())
  importance  String
  description String? @db.Text

  abilityId String
  ability   AbilityScorePriority @relation(fields: [abilityId], references: [id], onDelete: Cascade)
}

model RoleDescription {
  id          String  @id @default(uuid())
  name        String  @unique
  description String  @db.Text
  seeded      Boolean @default(false)

  keyAbilities RoleKeyAbility[]
  bestClasses  RoleBestClass[]
}

model RoleKeyAbility {
  id      String @id @default(uuid())
  ability String

  roleId String
  role   RoleDescription @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model RoleBestClass {
  id        String @id @default(uuid())
  className String

  roleId String
  role   RoleDescription @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model ComplexityLevel {
  id          String  @id @default(uuid())
  level       String  @unique
  description String  @db.Text
  seeded      Boolean @default(false)

  classes ComplexityClass[]
}

model ComplexityClass {
  id        String @id @default(uuid())
  className String

  complexityId String
  complexity   ComplexityLevel @relation(fields: [complexityId], references: [id], onDelete: Cascade)
}

// ============================================================================
// MONSTER SLAYERS GUIDE (BESTIARY)
// ============================================================================

enum ContinentCreatureRelation {
  PRIMARY
  SECONDARY
  RARE
}

model ContinentCreatureType {
  id        String                    @id @default(uuid())
  seeded    Boolean                   @default(false)
  relation  ContinentCreatureRelation
  reasoning String?                   @db.Text

  continentId    String
  continent      Continent    @relation(fields: [continentId], references: [id], onDelete: Cascade)
  creatureTypeId String
  creatureType   CreatureType @relation(fields: [creatureTypeId], references: [id], onDelete: Cascade)

  @@unique([continentId, creatureTypeId])
}

model CreatureType {
  id          String  @id @default(uuid())
  name        String  @unique
  slug        String  @unique
  description String  @db.Text
  habits      String? @db.Text
  tactics     String? @db.Text
  weaknesses  String? @db.Text
  seeded      Boolean @default(false)

  commonSizes CreatureSize[] @relation("CreatureTypeCommonSizes")

  continents         ContinentCreatureType[]
  characters         Character[]
  legendaryCreatures LegendaryCreature[]
}

model CreatureSize {
  id            String  @id @default(uuid())
  seeded        Boolean @default(false)
  name          String  @unique
  occupiedSpace String
  heightRange   String
  weightRange   String
  description   String? @db.Text

  creatureTypes      CreatureType[]      @relation("CreatureTypeCommonSizes")
  races Race[]
  characters         Character[]
  legendaryCreatures LegendaryCreature[]
}

enum LegendaryCreatureThreatLevel {
  CITY
  REGIONAL
  CONTINENTAL
  GLOBAL
}

model LegendaryCreature {
  id              String  @id @default(uuid())
  name            String
  description     String  @db.Text
  threatLevel     LegendaryCreatureThreatLevel
  questPotential  String? @db.Text
  isPast          Boolean @default(false)
  defeatedBy      String?
  defeatedByTitle String?
  defeatStory     String? @db.Text
  legacy          String? @db.Text
  seeded          Boolean @default(false)

  creatureSizeId String
  creatureSize   CreatureSize @relation(fields: [creatureSizeId], references: [id], onDelete: Cascade)

  creatureTypeId String
  creatureType   CreatureType @relation(fields: [creatureTypeId], references: [id], onDelete: Cascade)

  continentId String
  continent   Continent @relation(fields: [continentId], references: [id])
}
